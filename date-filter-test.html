<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Date Filter Test - Site Migration Dashboard</title>
  <style>body{font-family:Segoe UI,Arial;margin:24px} pre{background:#f4f4f4;padding:12px;border-radius:6px}</style>
</head>
<body>
  <h2>Date Filter Test (America/New_York midnight normalization)</h2>
  <p>Open the browser console to see raw numeric UTC ms. The page will also show human-readable UTC timestamps.</p>
  <div id="results"></div>

  <script src="./Site-Migration-Dashboard.js"></script>
  <script>
    function show(label, v){
      try{
        const ms = dateToUtcMidnightMs(v);
        const text = ms==null ? 'null' : (new Date(ms)).toISOString() + ' ('+ms+')';
        console.log(label, '->', v, '=>', text);
        const el = document.createElement('pre');
        el.textContent = label + ' => ' + v + '\n' + text;
        document.getElementById('results').appendChild(el);
      }catch(e){
        console.error('error for', v, e);
      }
    }

    // Samples: a date string, a previous-day US timestamp (EDT), and a small time into the desired day
    show('Date-only ISO', '2025-10-01');
    show('Date-only ISO prev', '2025-09-30');
    show('EDT timestamp (9/30 8:50pm EDT)', new Date('2025-09-30T20:50:00-04:00').toString());
    show('EDT timestamp (10/01 00:10 EDT)', new Date('2025-10-01T00:10:00-04:00').toString());

    // Also show numeric record-ms vs filter-from behavior example:
    (function(){
      const recordMs = new Date('2025-09-30T20:50:00-04:00').getTime();
      const filterFromMs = dateToUtcMidnightMs('2025-10-01');
      const inRange = filterFromMs != null && recordMs >= filterFromMs;
      const note = '\nrecord (EDT 2025-09-30 20:50 EDT) ms: '+recordMs+' => '+new Date(recordMs).toISOString() + '\nfilterFrom (ET midnight for 2025-10-01): '+filterFromMs+' => '+(filterFromMs?new Date(filterFromMs).toISOString():'null') + '\nrecord >= filterFrom? ' + inRange;
      const el = document.createElement('pre'); el.textContent = 'Range Example:' + note; document.getElementById('results').appendChild(el);
      console.log('Range example', note);
    })();

    // Simple benchmark: call dateToUtcMidnightMs many times on a mix of inputs and show timing
    function runBenchmark(iterations){
      const samples = ['2025-10-01','2025-09-30','9/30/2025','2025-10-01T00:10:00-04:00', new Date('2025-09-30T20:50:00-04:00')];
      const start = performance.now();
      for (let i=0;i<iterations;i++){
        const v = samples[i % samples.length];
        // call repeatedly, some duplicates to exercise cache
        dateToUtcMidnightMs(v);
      }
      const dur = performance.now() - start;
      const el = document.createElement('pre');
      el.textContent = `Benchmark (${iterations} calls): ${dur.toFixed(2)} ms (${(dur/iterations).toFixed(4)} ms/call)`;
      document.getElementById('results').appendChild(el);
      console.log('Benchmark result', dur, 'ms');
    }

    // Run a modest benchmark automatically
    setTimeout(()=> runBenchmark(20000), 100);
  </script>
</body>
</html>