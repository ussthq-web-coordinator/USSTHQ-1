<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Staff Grid Test - Local Test</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.0/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="rsyc-generator-v2.css">
    <style>
        body { padding: 20px; background-color: #F7A200;}
        .test-container { max-width: 1400px; margin: 0 auto; }
        .test-info { background: #f0f7f7; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .test-info h6 { color: #00929C; margin-bottom: 10px; }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-info">
            <h6><i class="bi bi-info-circle"></i> Staff & Community Leaders Grid Test</h6>
            <p class="mb-0 small">Testing the new aggregated staff and community leaders display with center information and bios</p>
            <div class="mt-3" style="display:flex; gap:10px; flex-wrap:wrap;">
                <button id="copyStaffTable" class="btn btn-sm btn-primary">
                    <i class="bi bi-clipboard"></i> Copy Staff Table
                </button>
            </div>
        </div>

           <!-- Staff & Community Leaders Grid Only -->
           <div id="unit-page" data-rsyc-unit-type="all" data-rsyc-unit-value="all" data-rsyc-unit-section="staff"
               data-rsyc-staff-filters="false" data-rsyc-staff-bg="false" data-rsyc-staff-padding="compact"></div>
    </div>

    <!-- Only load the injector - it will load all dependencies -->
    <script src="rsyc-unit-injector.js?v=injector-dev"></script>

    <!-- Debug helper (optional - remove in production) -->
    <script src="rsyc-unit-debug.js?v=injector-dev"></script>

    <script>
        // Show status when page loads
        window.addEventListener('load', () => {
            console.log('\n%c✨ Staff Grid Test Loaded ✨', 'font-size: 16px; color: #00929C; font-weight: bold;');
            console.log('Expected Features:');
            console.log('  • Centers grid at top');
            console.log('  • Staff & Leaders aggregated grid below');
            console.log('  • Staff cards with: Photo, Name, Title, Center, City, State, Bio');
            console.log('  • Filters for State, City, Position Type');
            console.log('  • Filterable by center location and role');

            const escapeHTML = (text) => {
                const map = { '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;' };
                return String(text || '').replace(/[&<>"']/g, (m) => map[m]);
            };

            const buildStaffTableHtmlFromDom = () => {
                const cards = Array.from(document.querySelectorAll('.staff-card'));
                const rows = cards.map((card) => {
                    const img = card.querySelector('img');
                    const photo = img?.getAttribute('src') || '';
                    const name = card.querySelector('.fw-bold')?.textContent?.trim() || '';
                    const title = card.querySelector('.text-muted')?.textContent?.trim() || '';
                    const bio = card.querySelector('.card-text')?.textContent?.trim() || '';

                    const centerLine = Array.from(card.querySelectorAll('p')).find(p => (p.textContent || '').includes('Open Center Profile') === false && p.querySelector('.bi-building'));
                    const locationLine = Array.from(card.querySelectorAll('p')).find(p => p.querySelector('.bi-geo-alt'));
                    const centerName = centerLine?.textContent?.trim() || '';
                    const location = locationLine?.textContent?.trim() || '';
                    const link = card.querySelector('a[href]')?.getAttribute('href') || '';

                    return {
                        photo,
                        name,
                        title,
                        centerName,
                        location,
                        bio,
                        link
                    };
                });

                const titleBlock = `
                    <div style="font-family: 'Segoe UI', Tahoma, sans-serif; color: #333; max-width: 900px; line-height: 1.4;">
                        <h2 style="margin: 0 0 12px 0; font-size: 18px;">Staff &amp; Community Leaders</h2>
                        <table role="presentation" cellspacing="0" cellpadding="0" border="0" style="border-collapse: collapse; width: 100%; font-size: 12.5px;">
                            <tr>
                                <th align="left" style="border: 1px solid #e5e5e5; padding: 8px; background: #fafafa;">Photo</th>
                                <th align="left" style="border: 1px solid #e5e5e5; padding: 8px; background: #fafafa;">Name</th>
                                <th align="left" style="border: 1px solid #e5e5e5; padding: 8px; background: #fafafa;">Center</th>
                                <th align="left" style="border: 1px solid #e5e5e5; padding: 8px; background: #fafafa;">Bio</th>
                            </tr>
                `;

                const bodyRows = rows.map((r) => {
                    const photoCell = r.photo
                        ? `<img src="${escapeHTML(r.photo)}" alt="${escapeHTML(r.name)}" style="width: 90px; height: 90px; object-fit: cover; display:block; border-radius: 6px;">`
                        : '';

                    const nameCell = `
                        <div style="font-weight: 700; margin-bottom: 2px;">${escapeHTML(r.name)}</div>
                        <div style="color: #666;">${escapeHTML(r.title)}</div>
                    `;

                    const centerCell = `
                        <div style="font-weight: 600;">${escapeHTML(r.centerName)}</div>
                        <div style="color: #666;">${escapeHTML(r.location)}</div>
                        ${r.link ? `<div style="margin-top: 6px;"><a href="${escapeHTML(r.link)}" style="color:#00929C; text-decoration: underline;">Open Center Profile</a></div>` : ''}
                    `;

                    const bioCell = `<div>${escapeHTML(r.bio)}</div>`;

                    return `
                        <tr>
                            <td valign="top" style="border: 1px solid #e5e5e5; padding: 8px; width: 110px;">${photoCell}</td>
                            <td valign="top" style="border: 1px solid #e5e5e5; padding: 8px; width: 210px;">${nameCell}</td>
                            <td valign="top" style="border: 1px solid #e5e5e5; padding: 8px; width: 260px;">${centerCell}</td>
                            <td valign="top" style="border: 1px solid #e5e5e5; padding: 8px;">${bioCell}</td>
                        </tr>
                    `;
                }).join('');

                const footerBlock = `
                        </table>
                    </div>
                `;

                return titleBlock + bodyRows + footerBlock;
            };

            const copyHtmlToClipboard = async (html) => {
                const blob = new Blob([html], { type: 'text/html' });
                const data = [new ClipboardItem({ 'text/html': blob })];
                await navigator.clipboard.write(data);
            };

            const copyBtn = document.getElementById('copyStaffTable');
            if (copyBtn) {
                copyBtn.addEventListener('click', async () => {
                    const cards = document.querySelectorAll('.staff-card');
                    if (!cards.length) {
                        alert('No staff cards found yet. Wait for the grid to load, then try again.');
                        return;
                    }
                    const html = buildStaffTableHtmlFromDom();
                    try {
                        await copyHtmlToClipboard(html);
                        const original = copyBtn.innerHTML;
                        copyBtn.innerHTML = '<i class="bi bi-check-circle"></i> Copied!';
                        setTimeout(() => (copyBtn.innerHTML = original), 2000);
                    } catch (e) {
                        console.error('Copy failed:', e);
                        alert('Copy failed. Check browser clipboard permissions and try again.');
                    }
                });
            }

            setTimeout(() => {
                if (document.querySelectorAll('.staff-card').length > 0) {
                    console.log('✓ Staff cards rendered successfully!');
                    console.log('✓ Staff grid count:', document.querySelectorAll('.staff-card').length);
                }
            }, 2000);
        });
    </script>
</body>
</html>
